CREATE TABLE actividad (id INT AUTO_INCREMENT, id_categoria INT NOT NULL, nombre VARCHAR(200) NOT NULL, fecha TIMESTAMP NOT NULL, id_tipo_calificacion INT NOT NULL, INDEX id_tipo_calificacion_idx (id_tipo_calificacion), INDEX id_categoria_idx (id_categoria), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE asistencia (id_curso INT, id_usuario VARCHAR(45), fecha TIMESTAMP NOT NULL, valor CHAR(1) NOT NULL, PRIMARY KEY(id_curso, id_usuario)) ENGINE = INNODB;
CREATE TABLE ayudantecurso (id_curso INT, id_usuario VARCHAR(45), estado INT NOT NULL, PRIMARY KEY(id_curso, id_usuario)) ENGINE = INNODB;
CREATE TABLE calificacion (id_estudiante VARCHAR(45), id_item INT, id_usuario VARCHAR(45) NOT NULL, valor FLOAT(18, 2) NOT NULL, fecha TIMESTAMP NOT NULL, INDEX id_usuario_idx (id_usuario), PRIMARY KEY(id_estudiante, id_item)) ENGINE = INNODB;
CREATE TABLE categoria (id INT AUTO_INCREMENT, id_curso INT NOT NULL, nombre VARCHAR(200) NOT NULL, periodo INT NOT NULL, porcentaje INT NOT NULL, id_tipo_categoria INT NOT NULL, INDEX id_tipo_categoria_idx (id_tipo_categoria), INDEX id_curso_idx (id_curso), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE curso (id INT AUTO_INCREMENT, anio INT NOT NULL, termino INT NOT NULL, id_materia VARCHAR(50) NOT NULL, paralelo INT NOT NULL, profesor VARCHAR(45) NOT NULL, factor_asistencia1 CHAR(1) NOT NULL, factor_asistencia2 CHAR(1) NOT NULL, INDEX id_materia_idx (id_materia), INDEX profesor_idx (profesor), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE estudiantecurso (id_curso INT, id_usuario VARCHAR(45), id_grupo INT, INDEX id_grupo_idx (id_grupo), PRIMARY KEY(id_curso, id_usuario)) ENGINE = INNODB;
CREATE TABLE grupo (id INT AUTO_INCREMENT, id_curso INT NOT NULL, numero INT NOT NULL, INDEX id_curso_idx (id_curso), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE item (id INT AUTO_INCREMENT, id_actividad INT NOT NULL, literal INT NOT NULL, nombre TEXT NOT NULL, valor_max INT NOT NULL, INDEX id_actividad_idx (id_actividad), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE logs (id_estudiante INT, id_item INT, id_usuario INT NOT NULL, nota_anterior FLOAT(18, 2), nota_nueva FLOAT(18, 2) NOT NULL, fecha TIMESTAMP NOT NULL, PRIMARY KEY(id_estudiante, id_item)) ENGINE = INNODB;
CREATE TABLE materia (id_codigo VARCHAR(50), nombre TEXT NOT NULL, PRIMARY KEY(id_codigo)) ENGINE = INNODB;
CREATE TABLE rolusuario (id INT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, detalle VARCHAR(200) DEFAULT ' ' NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE tipocalificacion (id INT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, detalle VARCHAR(200) DEFAULT ' ' NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE tipocategoria (id INT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, detalle VARCHAR(200) DEFAULT ' ' NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE usuario (id VARCHAR(45), nombre VARCHAR(100) NOT NULL, mail VARCHAR(50) NOT NULL, id_rol INT NOT NULL, INDEX id_rol_idx (id_rol), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE actividad ADD CONSTRAINT actividad_id_tipo_calificacion_tipocalificacion_id FOREIGN KEY (id_tipo_calificacion) REFERENCES tipocalificacion(id);
ALTER TABLE actividad ADD CONSTRAINT actividad_id_categoria_categoria_id FOREIGN KEY (id_categoria) REFERENCES categoria(id);
ALTER TABLE asistencia ADD CONSTRAINT asistencia_id_usuario_usuario_id FOREIGN KEY (id_usuario) REFERENCES usuario(id);
ALTER TABLE asistencia ADD CONSTRAINT asistencia_id_curso_curso_id FOREIGN KEY (id_curso) REFERENCES curso(id);
ALTER TABLE ayudantecurso ADD CONSTRAINT ayudantecurso_id_usuario_usuario_id FOREIGN KEY (id_usuario) REFERENCES usuario(id);
ALTER TABLE ayudantecurso ADD CONSTRAINT ayudantecurso_id_curso_curso_id FOREIGN KEY (id_curso) REFERENCES curso(id);
ALTER TABLE calificacion ADD CONSTRAINT calificacion_id_usuario_usuario_id FOREIGN KEY (id_usuario) REFERENCES usuario(id);
ALTER TABLE calificacion ADD CONSTRAINT calificacion_id_item_item_id FOREIGN KEY (id_item) REFERENCES item(id);
ALTER TABLE categoria ADD CONSTRAINT categoria_id_tipo_categoria_tipocategoria_id FOREIGN KEY (id_tipo_categoria) REFERENCES tipocategoria(id);
ALTER TABLE categoria ADD CONSTRAINT categoria_id_curso_curso_id FOREIGN KEY (id_curso) REFERENCES curso(id);
ALTER TABLE curso ADD CONSTRAINT curso_profesor_usuario_id FOREIGN KEY (profesor) REFERENCES usuario(id);
ALTER TABLE curso ADD CONSTRAINT curso_id_materia_materia_id_codigo FOREIGN KEY (id_materia) REFERENCES materia(id_codigo);
ALTER TABLE estudiantecurso ADD CONSTRAINT estudiantecurso_id_usuario_usuario_id FOREIGN KEY (id_usuario) REFERENCES usuario(id);
ALTER TABLE estudiantecurso ADD CONSTRAINT estudiantecurso_id_grupo_grupo_id FOREIGN KEY (id_grupo) REFERENCES grupo(id);
ALTER TABLE estudiantecurso ADD CONSTRAINT estudiantecurso_id_curso_curso_id FOREIGN KEY (id_curso) REFERENCES curso(id);
ALTER TABLE grupo ADD CONSTRAINT grupo_id_curso_curso_id FOREIGN KEY (id_curso) REFERENCES curso(id);
ALTER TABLE item ADD CONSTRAINT item_id_actividad_actividad_id FOREIGN KEY (id_actividad) REFERENCES actividad(id);
ALTER TABLE usuario ADD CONSTRAINT usuario_id_rol_rolusuario_id FOREIGN KEY (id_rol) REFERENCES rolusuario(id);
